<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de V√≠deo Standalone - HTML Puro</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background: #1a1a1a;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .video-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        video {
            width: 320px;
            height: 240px;
            background: #000;
            border: 2px solid #333;
            border-radius: 8px;
        }
        
        .controls {
            margin: 20px 0;
        }
        
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        .log {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
        }
        
        .success { background: #155724; border: 1px solid #28a745; }
        .error { background: #721c24; border: 1px solid #dc3545; }
        .warning { background: #856404; border: 1px solid #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîç Teste de V√≠deo HTML Puro</h1>
        <p>Este teste valida o funcionamento b√°sico da c√¢mera sem React ou frameworks.</p>
        
        <div class="controls">
            <button onclick="startCamera()">üìπ Iniciar C√¢mera</button>
            <button onclick="stopCamera()">‚èπÔ∏è Parar C√¢mera</button>
            <button onclick="runDiagnostics()">üîç Executar Diagn√≥stico</button>
            <button onclick="clearLog()">üßπ Limpar Log</button>
        </div>
        
        <div class="video-container">
            <div>
                <h3>V√≠deo Principal</h3>
                <video id="mainVideo" autoplay muted playsinline></video>
                <div id="mainStatus" class="status">Aguardando...</div>
            </div>
            
            <div>
                <h3>V√≠deo de Teste</h3>
                <video id="testVideo" autoplay muted playsinline></video>
                <div id="testStatus" class="status">Aguardando...</div>
            </div>
        </div>
        
        <div>
            <h3>üìä Log de Diagn√≥stico</h3>
            <div id="logOutput" class="log">Pronto para iniciar testes...\n</div>
        </div>
    </div>

    <script>
        let currentStream = null;
        let testStream = null;
        
        function log(message) {
            const logOutput = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            logOutput.textContent += `[${timestamp}] ${message}\n`;
            logOutput.scrollTop = logOutput.scrollHeight;
            console.log(message);
        }
        
        function updateStatus(elementId, message, type = 'warning') {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = `status ${type}`;
        }
        
        async function startCamera() {
            try {
                log('üéØ Iniciando c√¢mera...');
                
                // Verificar suporte
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    throw new Error('getUserMedia n√£o suportado neste navegador');
                }
                
                log('‚úÖ getUserMedia suportado');
                log('üîç Protocolo: ' + window.location.protocol);
                log('üîç Contexto seguro: ' + window.isSecureContext);
                
                // Solicitar permiss√µes
                currentStream = await navigator.mediaDevices.getUserMedia({
                    video: { width: 640, height: 480 },
                    audio: true
                });
                
                log('‚úÖ Stream criado: ' + currentStream.id);
                log('üìä Tracks de v√≠deo: ' + currentStream.getVideoTracks().length);
                log('üìä Tracks de √°udio: ' + currentStream.getAudioTracks().length);
                
                // Atribuir ao v√≠deo principal
                const mainVideo = document.getElementById('mainVideo');
                mainVideo.srcObject = currentStream;
                
                log('‚úÖ srcObject atribu√≠do ao v√≠deo principal');
                
                // Aguardar eventos
                mainVideo.addEventListener('loadedmetadata', () => {
                    log('üì∫ loadedmetadata disparado');
                    log(`üìê Dimens√µes: ${mainVideo.videoWidth}x${mainVideo.videoHeight}`);
                });
                
                mainVideo.addEventListener('playing', () => {
                    log('‚ñ∂Ô∏è playing disparado');
                    updateStatus('mainStatus', `Reproduzindo ${mainVideo.videoWidth}x${mainVideo.videoHeight}`, 'success');
                });
                
                mainVideo.addEventListener('error', (e) => {
                    log('‚ùå Erro no v√≠deo: ' + e.message);
                    updateStatus('mainStatus', 'Erro: ' + e.message, 'error');
                });
                
                // Criar segundo stream para teste
                testStream = await navigator.mediaDevices.getUserMedia({
                    video: true,
                    audio: false
                });
                
                const testVideo = document.getElementById('testVideo');
                testVideo.srcObject = testStream;
                
                testVideo.addEventListener('playing', () => {
                    log('‚ñ∂Ô∏è V√≠deo de teste reproduzindo');
                    updateStatus('testStatus', `Teste OK ${testVideo.videoWidth}x${testVideo.videoHeight}`, 'success');
                });
                
                log('‚úÖ C√¢mera iniciada com sucesso');
                
            } catch (error) {
                log('‚ùå Erro ao iniciar c√¢mera: ' + error.message);
                updateStatus('mainStatus', 'Erro: ' + error.message, 'error');
                updateStatus('testStatus', 'Erro: ' + error.message, 'error');
            }
        }
        
        function stopCamera() {
            log('üõë Parando c√¢mera...');
            
            if (currentStream) {
                currentStream.getTracks().forEach(track => {
                    track.stop();
                    log('üõë Track parado: ' + track.kind);
                });
                currentStream = null;
            }
            
            if (testStream) {
                testStream.getTracks().forEach(track => track.stop());
                testStream = null;
            }
            
            document.getElementById('mainVideo').srcObject = null;
            document.getElementById('testVideo').srcObject = null;
            
            updateStatus('mainStatus', 'Parado', 'warning');
            updateStatus('testStatus', 'Parado', 'warning');
            
            log('‚úÖ C√¢mera parada');
        }
        
        async function runDiagnostics() {
            log('üîç === EXECUTANDO DIAGN√ìSTICO COMPLETO ===');
            
            try {
                // 1. Verificar permiss√µes
                log('1Ô∏è‚É£ Verificando permiss√µes...');
                const cameraPermission = await navigator.permissions.query({name: 'camera'});
                const micPermission = await navigator.permissions.query({name: 'microphone'});
                
                log(`üìπ Permiss√£o c√¢mera: ${cameraPermission.state}`);
                log(`üé§ Permiss√£o microfone: ${micPermission.state}`);
                
                // 2. Listar dispositivos
                log('2Ô∏è‚É£ Listando dispositivos...');
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(d => d.kind === 'videoinput');
                const audioDevices = devices.filter(d => d.kind === 'audioinput');
                
                log(`üìπ C√¢meras encontradas: ${videoDevices.length}`);
                videoDevices.forEach((device, i) => {
                    log(`  ${i + 1}. ${device.label || 'C√¢mera ' + (i + 1)}`);
                });
                
                log(`üé§ Microfones encontrados: ${audioDevices.length}`);
                audioDevices.forEach((device, i) => {
                    log(`  ${i + 1}. ${device.label || 'Microfone ' + (i + 1)}`);
                });
                
                // 3. Testar stream atual
                if (currentStream) {
                    log('3Ô∏è‚É£ Analisando stream atual...');
                    log(`üÜî Stream ID: ${currentStream.id}`);
                    log(`‚úÖ Stream ativo: ${currentStream.active}`);
                    
                    currentStream.getVideoTracks().forEach((track, i) => {
                        log(`üìπ Video Track ${i + 1}:`);
                        log(`  - Label: ${track.label}`);
                        log(`  - Enabled: ${track.enabled}`);
                        log(`  - ReadyState: ${track.readyState}`);
                        log(`  - Muted: ${track.muted}`);
                        
                        const settings = track.getSettings();
                        log(`  - Resolu√ß√£o: ${settings.width}x${settings.height}`);
                        log(`  - FPS: ${settings.frameRate}`);
                    });
                    
                    currentStream.getAudioTracks().forEach((track, i) => {
                        log(`üé§ Audio Track ${i + 1}:`);
                        log(`  - Label: ${track.label}`);
                        log(`  - Enabled: ${track.enabled}`);
                        log(`  - ReadyState: ${track.readyState}`);
                    });
                }
                
                // 4. Verificar elementos de v√≠deo
                log('4Ô∏è‚É£ Verificando elementos de v√≠deo...');
                const mainVideo = document.getElementById('mainVideo');
                const testVideo = document.getElementById('testVideo');
                
                [
                    { name: 'Principal', video: mainVideo },
                    { name: 'Teste', video: testVideo }
                ].forEach(({ name, video }) => {
                    log(`üì∫ V√≠deo ${name}:`);
                    log(`  - srcObject: ${video.srcObject ? 'Definido' : 'Null'}`);
                    log(`  - Dimens√µes: ${video.videoWidth}x${video.videoHeight}`);
                    log(`  - ReadyState: ${video.readyState}`);
                    log(`  - CurrentTime: ${video.currentTime.toFixed(2)}s`);
                    log(`  - Paused: ${video.paused}`);
                    log(`  - Muted: ${video.muted}`);
                });
                
                log('‚úÖ Diagn√≥stico conclu√≠do');
                
            } catch (error) {
                log('‚ùå Erro no diagn√≥stico: ' + error.message);
            }
        }
        
        function clearLog() {
            document.getElementById('logOutput').textContent = 'Log limpo...\n';
        }
        
        // Auto-iniciar c√¢mera e diagn√≥stico
        window.addEventListener('load', () => {
            log('üöÄ P√°gina carregada - Iniciando testes autom√°ticos');
            setTimeout(() => {
                startCamera().then(() => {
                    setTimeout(runDiagnostics, 3000);
                });
            }, 2000);
        });
    </script>
</body>
</html>
