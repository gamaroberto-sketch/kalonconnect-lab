<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simula√ß√£o Exata App - KalonConnect</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #007bff;
            color: white;
            padding: 20px;
            text-align: center;
        }
        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        .video-section {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .video-surface {
            background: #1f2937;
            border-radius: 24px;
            padding: 16px;
            height: 400px;
            display: flex;
            gap: 16px;
        }
        .video-container {
            flex: 1;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .video-main {
            flex: 1;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .video-label {
            padding: 8px 12px;
            font-size: 12px;
            color: white;
            background: rgba(0,0,0,0.7);
            text-align: center;
        }
        .controls-bar {
            background: white;
            border-radius: 24px;
            border: 1px solid #e5e7eb;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            padding: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }
        .control-btn {
            padding: 12px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            font-size: 16px;
            min-width: 48px;
            min-height: 48px;
        }
        .control-btn:hover {
            opacity: 0.8;
        }
        .control-btn.active {
            background: #10b981;
            color: white;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
        }
        .control-btn.inactive {
            background: #f3f4f6;
            color: #6b7280;
        }
        .control-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .debug-panel {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            height: 500px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 11px;
            line-height: 1.4;
        }
        .log-entry {
            padding: 2px 0;
            border-bottom: 1px solid #eee;
        }
        .log-entry.error {
            color: #dc3545;
            background: #f8d7da;
            padding: 4px;
            margin: 2px 0;
            border-radius: 3px;
        }
        .log-entry.success {
            color: #155724;
            background: #d4edda;
            padding: 4px;
            margin: 2px 0;
            border-radius: 3px;
        }
        .log-entry.warning {
            color: #856404;
            background: #fff3cd;
            padding: 4px;
            margin: 2px 0;
            border-radius: 3px;
        }
        .log-entry.info {
            color: #0c5460;
        }
        .status-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
            margin-bottom: 15px;
        }
        .status-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            padding: 8px;
            text-align: center;
        }
        .status-label {
            font-size: 10px;
            color: #6c757d;
            margin-bottom: 4px;
        }
        .status-value {
            font-weight: bold;
            font-size: 12px;
        }
        .status-value.success { color: #28a745; }
        .status-value.error { color: #dc3545; }
        .status-value.warning { color: #ffc107; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Simula√ß√£o EXATA - Aplica√ß√£o Principal</h1>
            <p>Reproduz exatamente o ambiente da p√°gina de consultations</p>
        </div>
        
        <div class="main-content">
            <div class="video-section">
                <!-- Simula√ß√£o do VideoSurface -->
                <div class="video-surface">
                    <!-- Container do v√≠deo local (StaticVideoContainer) -->
                    <div class="video-container">
                        <div class="video-main">
                            <video id="localVideo" autoplay muted playsinline></video>
                        </div>
                        <div class="video-label" id="localLabel">C√¢mera desligada</div>
                    </div>
                    
                    <!-- Container do v√≠deo remoto -->
                    <div class="video-container">
                        <div class="video-main">
                            <div style="color: #6b7280; text-align: center;">Cliente</div>
                        </div>
                        <div class="video-label">Cliente</div>
                    </div>
                </div>
                
                <!-- Simula√ß√£o do VideoControls -->
                <div class="controls-bar">
                    <button id="audioBtn" class="control-btn inactive" title="Microfone">üé§</button>
                    <button id="cameraBtn" class="control-btn inactive" title="C√¢mera">üìπ</button>
                    <button id="videoBtn" class="control-btn inactive" title="Compartilhar V√≠deo" disabled>üì∫</button>
                    <button id="screenBtn" class="control-btn inactive" title="Compartilhar Tela">üñ•Ô∏è</button>
                    <button id="stopAllBtn" class="control-btn" style="background: #dc3545; color: white;" title="Parar Tudo">üõë</button>
                </div>
            </div>
            
            <div class="debug-panel">
                <div class="status-grid">
                    <div class="status-item">
                        <div class="status-label">Stream</div>
                        <div id="streamStatus" class="status-value error">‚ùå Inativo</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">C√¢mera</div>
                        <div id="cameraStatus" class="status-value error">üì¥ OFF</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Dimens√µes</div>
                        <div id="dimensionsStatus" class="status-value">0x0</div>
                    </div>
                    <div class="status-item">
                        <div class="status-label">Tracks</div>
                        <div id="tracksStatus" class="status-value">0V/0A</div>
                    </div>
                </div>
                
                <div id="logContainer">
                    <div class="log-entry info">[In√≠cio] Simula√ß√£o exata carregada</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Elementos DOM
        const localVideo = document.getElementById('localVideo');
        const localLabel = document.getElementById('localLabel');
        const audioBtn = document.getElementById('audioBtn');
        const cameraBtn = document.getElementById('cameraBtn');
        const videoBtn = document.getElementById('videoBtn');
        const screenBtn = document.getElementById('screenBtn');
        const stopAllBtn = document.getElementById('stopAllBtn');
        const logContainer = document.getElementById('logContainer');
        
        // Status elements
        const streamStatus = document.getElementById('streamStatus');
        const cameraStatus = document.getElementById('cameraStatus');
        const dimensionsStatus = document.getElementById('dimensionsStatus');
        const tracksStatus = document.getElementById('tracksStatus');
        
        // Estado simulando VideoPanelContext
        let currentStream = null;
        let isCameraPreviewOn = false;
        let isAudioOn = false;
        let isVideoOn = false;
        let isScreenSharing = false;
        let isConnected = false;
        
        // Flags de prote√ß√£o (simulando as corre√ß√µes implementadas)
        let ensureStreamInProgress = false;
        let toggleCameraInProgress = false;
        let createStreamInProgress = false;
        
        // Interceptar console para logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLogEntry(args.join(' '), 'info');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            addLogEntry(args.join(' '), 'error');
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLogEntry(args.join(' '), 'warning');
        };
        
        function addLogEntry(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            
            logContainer.appendChild(entry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // Limitar entradas
            const entries = logContainer.children;
            if (entries.length > 200) {
                logContainer.removeChild(entries[0]);
            }
        }
        
        function updateUI() {
            // Bot√µes
            audioBtn.className = `control-btn ${isAudioOn ? 'active' : 'inactive'}`;
            cameraBtn.className = `control-btn ${isCameraPreviewOn ? 'active' : 'inactive'}`;
            videoBtn.className = `control-btn ${isVideoOn ? 'active' : 'inactive'}`;
            videoBtn.disabled = !currentStream || !isConnected;
            screenBtn.className = `control-btn ${isScreenSharing ? 'active' : 'inactive'}`;
            
            // Labels
            localLabel.textContent = isCameraPreviewOn ? 
                'Pr√©-visualiza√ß√£o do Profissional' : 
                'C√¢mera desligada';
            
            // Status
            streamStatus.textContent = currentStream && currentStream.active ? '‚úÖ Ativo' : '‚ùå Inativo';
            streamStatus.className = `status-value ${currentStream && currentStream.active ? 'success' : 'error'}`;
            
            cameraStatus.textContent = isCameraPreviewOn ? 'üìπ ON' : 'üì¥ OFF';
            cameraStatus.className = `status-value ${isCameraPreviewOn ? 'success' : 'error'}`;
            
            dimensionsStatus.textContent = `${localVideo.videoWidth}x${localVideo.videoHeight}`;
            dimensionsStatus.className = `status-value ${localVideo.videoWidth > 0 ? 'success' : 'error'}`;
            
            if (currentStream) {
                const vTracks = currentStream.getVideoTracks().length;
                const aTracks = currentStream.getAudioTracks().length;
                tracksStatus.textContent = `${vTracks}V/${aTracks}A`;
                tracksStatus.className = `status-value ${vTracks > 0 ? 'success' : 'error'}`;
            } else {
                tracksStatus.textContent = '0V/0A';
                tracksStatus.className = 'status-value error';
            }
        }
        
        // Simula√ß√£o EXATA do createMediaStream com todas as prote√ß√µes
        async function createMediaStream(constraints = { video: true, audio: true }) {
            console.log('üéØ === INICIANDO createMediaStream ROBUSTO ===');
            
            // PROTE√á√ÉO 1: M√∫ltiplas chamadas simult√¢neas
            if (createStreamInProgress) {
                console.warn('‚ö†Ô∏è createMediaStream j√° em progresso, aguardando...');
                let attempts = 0;
                while (createStreamInProgress && attempts < 100) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                console.log(`‚úÖ Chamada anterior conclu√≠da ap√≥s ${attempts * 100}ms`);
                return currentStream;
            }
            
            createStreamInProgress = true;
            
            try {
                // Reutilizar stream existente
                if (currentStream && currentStream.active) {
                    console.log('‚úÖ Stream j√° existe e est√° ativo, reutilizando');
                    return currentStream;
                }
                
                console.log('üîç Diagnosticando dispositivos dispon√≠veis...');
                const devices = await navigator.mediaDevices.enumerateDevices();
                const videoDevices = devices.filter(d => d.kind === 'videoinput');
                
                console.log(`üì± Dispositivos encontrados: ${videoDevices.length} c√¢meras`);
                
                if (videoDevices.length === 0) {
                    throw new Error('Nenhuma c√¢mera encontrada');
                }
                
                // Constraints de teste (vers√£o completa como na aplica√ß√£o)
                const testConstraints = [
                    { name: 'HD 720p', constraints: { video: { width: 1280, height: 720 }, audio: true } },
                    { name: 'VGA 480p', constraints: { video: { width: 640, height: 480 }, audio: true } },
                    { name: 'B√°sico Width True', constraints: { video: { width: true }, audio: true } },
                    { name: 'User Facing', constraints: { video: { facingMode: "user" }, audio: true } },
                    { name: 'Full HD 1080p', constraints: { video: { width: 1920, height: 1080 }, audio: true } },
                    { name: 'S√≥ V√≠deo HD', constraints: { video: { width: 1280, height: 720 }, audio: false } },
                    { name: 'S√≥ V√≠deo VGA', constraints: { video: { width: 640, height: 480 }, audio: false } },
                    { name: 'S√≥ V√≠deo B√°sico', constraints: { video: true, audio: false } },
                    { name: 'M√≠nimo', constraints: { video: { width: 320, height: 240 }, audio: false } },
                    { name: '√öltimo Recurso', constraints: { video: {} } }
                ];
                
                let successfulStream = null;
                
                console.log('üß™ === INICIANDO TESTES DE CONSTRAINTS VARIADAS ===');
                
                for (const test of testConstraints) {
                    try {
                        console.log(`üîÑ TESTANDO: ${test.name}`);
                        console.log(`üìã Constraints: ${JSON.stringify(test.constraints)}`);
                        
                        const timeoutPromise = new Promise((_, reject) => 
                            setTimeout(() => reject(new Error('Timeout ap√≥s 15 segundos')), 15000)
                        );
                        
                        const streamPromise = navigator.mediaDevices.getUserMedia(test.constraints);
                        const stream = await Promise.race([streamPromise, timeoutPromise]);
                        
                        console.log(`‚úÖ SUCESSO: ${test.name}`);
                        
                        // Usar primeiro stream bem-sucedido (PROTE√á√ÉO CR√çTICA)
                        if (!successfulStream) {
                            successfulStream = stream;
                            console.log(`üéØ USANDO STREAM: ${test.name} como stream principal`);
                            console.log('üõ°Ô∏è PROTE√á√ÉO: Mantendo stream ativo - N√ÉO ser√° parado');
                            
                            // Proteger tracks
                            stream.getVideoTracks().forEach(track => {
                                track.enabled = true;
                                console.log('üìπ Track de v√≠deo FOR√áADO como ativo');
                                
                                track.addEventListener('ended', () => {
                                    console.error('‚ùå CR√çTICO: Track de v√≠deo foi TERMINADO inesperadamente!');
                                });
                                
                                track.addEventListener('mute', () => {
                                    console.warn('‚ö†Ô∏è Track de v√≠deo foi MUTADO');
                                });
                            });
                            
                            // Desabilitar √°udio por padr√£o
                            stream.getAudioTracks().forEach(track => {
                                track.enabled = false;
                                console.log('üîá Track de √°udio desabilitado (mas mantido vivo)');
                            });
                            
                        } else {
                            // Parar streams de teste adicionais
                            stream.getTracks().forEach(track => track.stop());
                            console.log(`üõë Stream de teste ${test.name} parado (n√£o √© o principal)`);
                        }
                        
                        break; // Usar primeiro sucesso
                        
                    } catch (error) {
                        console.error(`‚ùå FALHOU: ${test.name} - ${error.message}`);
                        
                        if (error.name === 'NotAllowedError') {
                            console.error('üö´ ERRO FATAL: Permiss√£o negada - Parando todos os testes');
                            throw error;
                        }
                    }
                }
                
                if (successfulStream) {
                    console.log('‚úÖ === createMediaStream CONCLU√çDO COM SUCESSO ===');
                    
                    // PROTE√á√ÉO FINAL: Verificar se stream ainda est√° ativo
                    if (!successfulStream.active) {
                        console.error('‚ùå CR√çTICO: Stream foi desativado durante os testes!');
                        throw new Error('Stream foi perdido durante os testes');
                    }
                    
                    return successfulStream;
                } else {
                    console.error('‚ùå NENHUM TESTE FOI BEM-SUCEDIDO');
                    throw new Error('Todos os testes de constraints falharam');
                }
                
            } finally {
                createStreamInProgress = false;
                console.log('üßπ createMediaStream finalizado, flag limpa');
            }
        }
        
        // Simula√ß√£o EXATA do assignStreamToVideo
        async function assignStreamToVideo(stream) {
            console.log('üîó === EXECUTANDO ATRIBUI√á√ÉO CR√çTICA ===');
            
            // VERIFICA√á√ÉO FINAL ANTES DA ATRIBUI√á√ÉO
            if (!stream.active) {
                console.error('‚ùå CR√çTICO: Stream n√£o est√° ativo no momento da atribui√ß√£o!');
                return false;
            }
            
            const videoTracks = stream.getVideoTracks();
            if (videoTracks.length === 0) {
                console.error('‚ùå CR√çTICO: Stream n√£o possui tracks de v√≠deo!');
                return false;
            }
            
            const activeVideoTracks = videoTracks.filter(track => track.readyState === 'live');
            if (activeVideoTracks.length === 0) {
                console.error('‚ùå CR√çTICO: Nenhum track de v√≠deo est√° "live"!');
                return false;
            }
            
            console.log(`‚úÖ Stream validado: ${activeVideoTracks.length} tracks de v√≠deo ativos`);
            
            // ATRIBUI√á√ÉO REAL
            console.log('üéØ EXECUTANDO: videoElement.srcObject = stream');
            localVideo.srcObject = stream;
            console.log('‚úÖ Linha de atribui√ß√£o executada! Validando IMEDIATAMENTE...');
            
            // PROTE√á√ÉO: Verificar se atribui√ß√£o "colou"
            setTimeout(() => {
                if (localVideo.srcObject !== stream) {
                    console.error('‚ùå CR√çTICO: srcObject foi perdido ap√≥s atribui√ß√£o!');
                    console.log('üîÑ Tentando reatribuir...');
                    localVideo.srcObject = stream;
                } else {
                    console.log('‚úÖ srcObject mantido com sucesso ap√≥s 1 segundo');
                }
            }, 1000);
            
            // Eventos do v√≠deo
            localVideo.onloadedmetadata = () => {
                console.log(`üìä Metadados carregados: ${localVideo.videoWidth}x${localVideo.videoHeight}`);
                updateUI();
            };
            
            localVideo.onplaying = () => {
                console.log(`üé¨ V√≠deo reproduzindo: ${localVideo.videoWidth}x${localVideo.videoHeight}`);
                updateUI();
            };
            
            localVideo.onerror = (event) => {
                console.error('‚ùå ERRO no v√≠deo:', event);
            };
            
            localVideo.onwaiting = () => {
                console.warn('‚è≥ V√≠deo aguardando dados...');
            };
            
            localVideo.onstalled = () => {
                console.warn('üö´ V√≠deo travado...');
            };
            
            return true;
        }
        
        // Simula√ß√£o EXATA do ensureLocalStream
        async function ensureLocalStream() {
            console.log('üéØ === INICIANDO ensureLocalStream ===');
            
            // PROTE√á√ÉO: M√∫ltiplas chamadas simult√¢neas
            if (ensureStreamInProgress) {
                console.warn('‚ö†Ô∏è ensureLocalStream j√° est√° em progresso, aguardando...');
                let attempts = 0;
                while (ensureStreamInProgress && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }
                console.log(`‚úÖ Chamada anterior conclu√≠da ap√≥s ${attempts * 100}ms`);
                return currentStream;
            }
            
            ensureStreamInProgress = true;
            
            try {
                // Verificar stream existente
                if (currentStream && currentStream.active) {
                    console.log('‚úÖ Stream j√° existe e est√° ativo');
                    return currentStream;
                }
                
                console.log('üéØ Criando novo MediaStream...');
                const stream = await createMediaStream({ video: true, audio: true });
                
                if (!stream) {
                    console.error('‚ùå Falha ao criar MediaStream');
                    return null;
                }
                
                console.log('‚úÖ MediaStream criado, preparando atribui√ß√£o...');
                
                // ATRIBUI√á√ÉO CENTRALIZADA
                console.log('üîó === INICIANDO ATRIBUI√á√ÉO IMEDIATA DO STREAM ===');
                
                const success = await assignStreamToVideo(stream);
                
                if (success) {
                    currentStream = stream;
                    isConnected = true;
                    console.log('‚úÖ ensureLocalStream CONCLU√çDO COM SUCESSO');
                    
                    // Iniciar monitoramento cont√≠nuo
                    startStreamMonitoring();
                    
                    return stream;
                } else {
                    console.error('‚ùå FALHA CR√çTICA: assignStreamToVideo retornou false');
                    
                    // PROTE√á√ÉO: Se atribui√ß√£o falhou, parar o stream
                    if (stream) {
                        console.log('üõë Parando stream devido √† falha na atribui√ß√£o...');
                        stream.getTracks().forEach(track => track.stop());
                    }
                    
                    return null;
                }
                
            } catch (error) {
                console.error('‚ùå ERRO INESPERADO em ensureLocalStream:', error);
                return null;
            } finally {
                ensureStreamInProgress = false;
                console.log('üßπ ensureLocalStream finalizado, flag limpa');
            }
        }
        
        // Simula√ß√£o EXATA do toggleCameraPreview
        async function toggleCameraPreview() {
            console.log('üéØ toggleCameraPreview chamado');
            
            // PROTE√á√ÉO: M√∫ltiplas chamadas simult√¢neas
            if (toggleCameraInProgress) {
                console.warn('‚ö†Ô∏è toggleCameraPreview j√° est√° em progresso, ignorando...');
                return;
            }
            
            toggleCameraInProgress = true;
            
            try {
                if (isCameraPreviewOn) {
                    // DESLIGAR C√ÇMERA
                    console.log('üì¥ Desligando c√¢mera...');
                    
                    if (currentStream) {
                        currentStream.getTracks().forEach(track => track.stop());
                        currentStream = null;
                    }
                    
                    localVideo.srcObject = null;
                    isCameraPreviewOn = false;
                    isConnected = false;
                    
                    if (monitorInterval) {
                        clearInterval(monitorInterval);
                        monitorInterval = null;
                    }
                    
                    console.log('‚úÖ C√¢mera desligada');
                    
                } else {
                    // LIGAR C√ÇMERA
                    console.log('üìπ Ligando c√¢mera...');
                    
                    const stream = await ensureLocalStream();
                    
                    if (stream) {
                        // Habilitar tracks
                        stream.getVideoTracks().forEach(track => {
                            track.enabled = true;
                            console.log('‚úÖ Video track habilitado:', track.label);
                        });
                        
                        isCameraPreviewOn = true;
                        console.log('‚úÖ C√¢mera ligada com sucesso');
                    } else {
                        console.error('‚ùå Falha ao ligar c√¢mera');
                    }
                }
                
                updateUI();
                
            } catch (error) {
                console.error('‚ùå ERRO INESPERADO em toggleCameraPreview:', error);
            } finally {
                toggleCameraInProgress = false;
                console.log('üßπ toggleCameraPreview finalizado, flag limpa');
            }
        }
        
        let monitorInterval = null;
        
        function startStreamMonitoring() {
            if (monitorInterval) return;
            
            console.log('üîç Iniciando monitoramento cont√≠nuo do stream...');
            
            monitorInterval = setInterval(() => {
                if (currentStream && currentStream.active) {
                    const videoTracks = currentStream.getVideoTracks();
                    const activeTracks = videoTracks.filter(t => t.readyState === 'live');
                    
                    console.log(`‚úÖ Monitor: Stream ativo (${activeTracks.length}/${videoTracks.length} tracks live)`);
                    
                    if (localVideo.paused) {
                        console.warn('‚ö†Ô∏è Monitor: V√≠deo pausou, tentando reativar...');
                        localVideo.play().catch(error => {
                            console.error('‚ùå Monitor: Erro ao reativar:', error.message);
                        });
                    }
                    
                    updateUI();
                    
                } else {
                    console.error('‚ùå Monitor: Stream foi desativado!');
                    clearInterval(monitorInterval);
                    monitorInterval = null;
                    updateUI();
                }
            }, 5000); // Verificar a cada 5 segundos
        }
        
        function stopEverything() {
            console.log('üõë Parando tudo...');
            
            if (currentStream) {
                currentStream.getTracks().forEach(track => track.stop());
                currentStream = null;
            }
            
            localVideo.srcObject = null;
            isCameraPreviewOn = false;
            isAudioOn = false;
            isVideoOn = false;
            isScreenSharing = false;
            isConnected = false;
            
            if (monitorInterval) {
                clearInterval(monitorInterval);
                monitorInterval = null;
            }
            
            // Limpar flags
            ensureStreamInProgress = false;
            toggleCameraInProgress = false;
            createStreamInProgress = false;
            
            updateUI();
            console.log('‚úÖ Tudo parado');
        }
        
        // Event listeners
        cameraBtn.addEventListener('click', toggleCameraPreview);
        stopAllBtn.addEventListener('click', stopEverything);
        
        // Inicializa√ß√£o
        updateUI();
        console.log('üéØ Simula√ß√£o EXATA da aplica√ß√£o principal carregada');
        console.log('üí° Esta p√°gina reproduz EXATAMENTE o ambiente da p√°gina de consultations');
        console.log('üîß Todas as prote√ß√µes e corre√ß√µes est√£o implementadas');
        console.log('üìπ Clique no bot√£o da c√¢mera para testar');
    </script>
</body>
</html>


