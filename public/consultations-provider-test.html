<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Providers - Consultations</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .provider-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .provider-control {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
        }
        
        .provider-control.active {
            border-color: #28a745;
            background: #d4edda;
        }
        
        .provider-control.inactive {
            border-color: #dc3545;
            background: #f8d7da;
        }
        
        .provider-toggle {
            padding: 8px 16px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
            transition: all 0.2s;
        }
        
        .provider-toggle.active {
            background: #dc3545;
            color: white;
        }
        
        .provider-toggle.inactive {
            background: #28a745;
            color: white;
        }
        
        .video-test-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .video-container {
            background: #000;
            border-radius: 12px;
            padding: 16px;
            min-height: 300px;
            display: flex;
            flex-direction: column;
        }
        
        .video-main {
            flex: 1;
            background: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            overflow: hidden;
        }
        
        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .video-label {
            padding: 8px 12px;
            font-size: 12px;
            color: white;
            background: rgba(0,0,0,0.7);
            text-align: center;
            margin-top: 8px;
            border-radius: 4px;
        }
        
        .controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }
        
        .btn:hover { opacity: 0.8; }
        
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            line-height: 1.4;
        }
        
        .log-entry {
            padding: 2px 0;
            border-bottom: 1px solid #eee;
        }
        
        .log-error { color: #dc3545; font-weight: bold; }
        .log-success { color: #28a745; }
        .log-warning { color: #ffc107; }
        .log-info { color: #17a2b8; }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-active { background: #28a745; }
        .status-inactive { background: #dc3545; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>üîç Teste de Providers - P√°gina Consultations</h1>
        <p>Remova providers um por um para identificar qual est√° causando o problema da c√¢mera</p>
        
        <!-- CONTROLES DE PROVIDERS -->
        <div class="provider-controls">
            <div class="provider-control active" id="authProvider">
                <h4>üîê AuthContext</h4>
                <div class="status-indicator status-active"></div>
                <span>Autentica√ß√£o e usu√°rio</span>
                <button class="provider-toggle active" onclick="toggleProvider('auth')">Desativar</button>
            </div>
            
            <div class="provider-control active" id="themeProvider">
                <h4>üé® ThemeProvider</h4>
                <div class="status-indicator status-active"></div>
                <span>Cores e temas</span>
                <button class="provider-toggle active" onclick="toggleProvider('theme')">Desativar</button>
            </div>
            
            <div class="provider-control active" id="usageProvider">
                <h4>üìä UsageTrackerProvider</h4>
                <div class="status-indicator status-active"></div>
                <span>Tracking de uso</span>
                <button class="provider-toggle active" onclick="toggleProvider('usage')">Desativar</button>
            </div>
            
            <div class="provider-control active" id="videoPanelProvider">
                <h4>üìπ VideoPanelProvider</h4>
                <div class="status-indicator status-active"></div>
                <span>Contexto de v√≠deo</span>
                <button class="provider-toggle active" onclick="toggleProvider('videoPanel')">Desativar</button>
            </div>
            
            <div class="provider-control active" id="reactEffects">
                <h4>‚öõÔ∏è React Effects</h4>
                <div class="status-indicator status-active"></div>
                <span>useEffect/useState</span>
                <button class="provider-toggle active" onclick="toggleProvider('effects')">Desativar</button>
            </div>
            
            <div class="provider-control active" id="complexCSS">
                <h4>üé® CSS Complexo</h4>
                <div class="status-indicator status-active"></div>
                <span>Tailwind/Transforms</span>
                <button class="provider-toggle active" onclick="toggleProvider('css')">Desativar</button>
            </div>
        </div>
        
        <!-- √ÅREA DE TESTE DE V√çDEO -->
        <div class="video-test-area">
            <!-- V√çDEO COM PROVIDERS ATIVOS -->
            <div class="video-container">
                <div class="video-main">
                    <video id="videoWithProviders" autoplay muted playsinline></video>
                </div>
                <div class="video-label" id="labelWithProviders">V√≠deo COM Providers</div>
            </div>
            
            <!-- V√çDEO SEM PROVIDERS (CONTROLE) -->
            <div class="video-container">
                <div class="video-main">
                    <video id="videoWithoutProviders" autoplay muted playsinline></video>
                </div>
                <div class="video-label" id="labelWithoutProviders">V√≠deo SEM Providers (Controle)</div>
            </div>
        </div>
        
        <!-- CONTROLES -->
        <div class="controls">
            <button class="btn btn-success" onclick="testWithProviders()">üìπ Testar COM Providers</button>
            <button class="btn btn-primary" onclick="testWithoutProviders()">üß™ Testar SEM Providers</button>
            <button class="btn btn-warning" onclick="compareResults()">‚öñÔ∏è Comparar Resultados</button>
            <button class="btn btn-danger" onclick="stopAllTests()">üõë Parar Tudo</button>
        </div>
        
        <!-- LOGS -->
        <div class="log-area" id="logArea">
            <div class="log-entry log-info">[In√≠cio] Teste de providers carregado</div>
        </div>
    </div>

    <script>
        // Estado dos providers
        const providerState = {
            auth: true,
            theme: true,
            usage: true,
            videoPanel: true,
            effects: true,
            css: true
        };
        
        // Streams ativos
        let streamWithProviders = null;
        let streamWithoutProviders = null;
        
        // Elementos
        const videoWithProviders = document.getElementById('videoWithProviders');
        const videoWithoutProviders = document.getElementById('videoWithoutProviders');
        const logArea = document.getElementById('logArea');
        
        // Fun√ß√£o de log
        function addLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${timestamp}] ${message}`;
            
            logArea.appendChild(entry);
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(`[PROVIDER-TEST] [${type.toUpperCase()}] ${message}`);
            
            // Limitar entradas
            if (logArea.children.length > 100) {
                logArea.removeChild(logArea.children[0]);
            }
        }
        
        // Toggle de provider
        function toggleProvider(providerName) {
            const isActive = providerState[providerName];
            providerState[providerName] = !isActive;
            
            const providerElement = document.getElementById(`${providerName}Provider`);
            const button = providerElement.querySelector('.provider-toggle');
            const indicator = providerElement.querySelector('.status-indicator');
            
            if (providerState[providerName]) {
                // Ativar
                providerElement.className = 'provider-control active';
                button.className = 'provider-toggle active';
                button.textContent = 'Desativar';
                indicator.className = 'status-indicator status-active';
                addLog(`‚úÖ ${providerName} ATIVADO`, 'success');
            } else {
                // Desativar
                providerElement.className = 'provider-control inactive';
                button.className = 'provider-toggle inactive';
                button.textContent = 'Ativar';
                indicator.className = 'status-indicator status-inactive';
                addLog(`‚ùå ${providerName} DESATIVADO`, 'warning');
            }
            
            // Aplicar mudan√ßas visuais baseadas no estado
            applyProviderEffects();
        }
        
        // Aplicar efeitos dos providers
        function applyProviderEffects() {
            // CSS Complexo
            if (providerState.css) {
                videoWithProviders.style.transform = 'translateZ(0)';
                videoWithProviders.style.willChange = 'transform';
                videoWithProviders.style.backfaceVisibility = 'hidden';
                addLog('üé® CSS complexo aplicado', 'info');
            } else {
                videoWithProviders.style.transform = 'none';
                videoWithProviders.style.willChange = 'auto';
                videoWithProviders.style.backfaceVisibility = 'visible';
                addLog('üé® CSS simplificado', 'info');
            }
            
            // Simular efeitos de providers
            if (!providerState.effects) {
                addLog('‚öõÔ∏è React Effects desabilitados - comportamento simplificado', 'warning');
            }
        }
        
        // Teste COM providers (simulando aplica√ß√£o complexa)
        async function testWithProviders() {
            addLog('=== TESTE COM PROVIDERS (SIMULANDO APLICA√á√ÉO COMPLEXA) ===', 'info');
            
            try {
                // Simular complexidade baseada nos providers ativos
                if (providerState.auth) {
                    addLog('üîê Simulando AuthContext...', 'warning');
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                if (providerState.theme) {
                    addLog('üé® Simulando ThemeProvider...', 'warning');
                    await new Promise(resolve => setTimeout(resolve, 50));
                }
                
                if (providerState.usage) {
                    addLog('üìä Simulando UsageTrackerProvider...', 'warning');
                    await new Promise(resolve => setTimeout(resolve, 75));
                }
                
                if (providerState.videoPanel) {
                    addLog('üìπ Simulando VideoPanelProvider...', 'warning');
                    await new Promise(resolve => setTimeout(resolve, 150));
                }
                
                if (providerState.effects) {
                    addLog('‚öõÔ∏è Simulando m√∫ltiplos useEffect...', 'warning');
                    await new Promise(resolve => setTimeout(resolve, 200));
                }
                
                // Criar stream
                addLog('üìã Obtendo stream com contexto complexo...', 'info');
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: false 
                });
                
                addLog('‚úÖ Stream obtido COM providers', 'success');
                
                // Simular atribui√ß√£o complexa
                if (providerState.videoPanel) {
                    addLog('üîÑ Simulando atribui√ß√£o via VideoPanelContext...', 'warning');
                    await new Promise(resolve => setTimeout(resolve, 100));
                }
                
                // Atribuir stream
                videoWithProviders.srcObject = stream;
                streamWithProviders = stream;
                
                addLog('‚úÖ srcObject atribu√≠do COM providers', 'success');
                
                // Eventos
                videoWithProviders.onloadedmetadata = () => {
                    addLog(`üìä COM PROVIDERS: Metadados ${videoWithProviders.videoWidth}x${videoWithProviders.videoHeight}`, 'success');
                    document.getElementById('labelWithProviders').textContent = 
                        `COM Providers (${videoWithProviders.videoWidth}x${videoWithProviders.videoHeight})`;
                };
                
                videoWithProviders.onplaying = () => {
                    addLog('üéâ COM PROVIDERS: V√çDEO FUNCIONANDO!', 'success');
                };
                
                videoWithProviders.onerror = (e) => {
                    addLog(`‚ùå COM PROVIDERS: Erro - ${e.message}`, 'error');
                };
                
                await videoWithProviders.play();
                addLog('‚ñ∂Ô∏è COM PROVIDERS: Play executado', 'success');
                
            } catch (error) {
                addLog(`‚ùå COM PROVIDERS: ERRO - ${error.message}`, 'error');
            }
        }
        
        // Teste SEM providers (controle simples)
        async function testWithoutProviders() {
            addLog('=== TESTE SEM PROVIDERS (CONTROLE SIMPLES) ===', 'info');
            
            try {
                // Implementa√ß√£o direta sem simula√ß√£o de complexidade
                addLog('üìã Obtendo stream DIRETO (sem providers)...', 'info');
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: true, 
                    audio: false 
                });
                
                addLog('‚úÖ Stream obtido SEM providers', 'success');
                
                // Atribui√ß√£o direta
                videoWithoutProviders.srcObject = stream;
                streamWithoutProviders = stream;
                
                addLog('‚úÖ srcObject atribu√≠do SEM providers (DIRETO)', 'success');
                
                // Eventos
                videoWithoutProviders.onloadedmetadata = () => {
                    addLog(`üìä SEM PROVIDERS: Metadados ${videoWithoutProviders.videoWidth}x${videoWithoutProviders.videoHeight}`, 'success');
                    document.getElementById('labelWithoutProviders').textContent = 
                        `SEM Providers (${videoWithoutProviders.videoWidth}x${videoWithoutProviders.videoHeight})`;
                };
                
                videoWithoutProviders.onplaying = () => {
                    addLog('üéâ SEM PROVIDERS: V√çDEO FUNCIONANDO!', 'success');
                };
                
                await videoWithoutProviders.play();
                addLog('‚ñ∂Ô∏è SEM PROVIDERS: Play executado', 'success');
                
            } catch (error) {
                addLog(`‚ùå SEM PROVIDERS: ERRO - ${error.message}`, 'error');
            }
        }
        
        // Comparar resultados
        function compareResults() {
            addLog('=== COMPARA√á√ÉO DE RESULTADOS ===', 'info');
            
            const withProviders = {
                hasStream: !!videoWithProviders.srcObject,
                hasVideo: videoWithProviders.videoWidth > 0,
                dimensions: `${videoWithProviders.videoWidth}x${videoWithProviders.videoHeight}`,
                readyState: videoWithProviders.readyState,
                paused: videoWithProviders.paused
            };
            
            const withoutProviders = {
                hasStream: !!videoWithoutProviders.srcObject,
                hasVideo: videoWithoutProviders.videoWidth > 0,
                dimensions: `${videoWithoutProviders.videoWidth}x${videoWithoutProviders.videoHeight}`,
                readyState: videoWithoutProviders.readyState,
                paused: videoWithoutProviders.paused
            };
            
            addLog('üìä COM PROVIDERS:', 'info');
            Object.entries(withProviders).forEach(([key, value]) => {
                const type = (key === 'hasStream' || key === 'hasVideo') && !value ? 'error' : 'info';
                addLog(`  ${key}: ${value}`, type);
            });
            
            addLog('üìä SEM PROVIDERS:', 'info');
            Object.entries(withoutProviders).forEach(([key, value]) => {
                const type = (key === 'hasStream' || key === 'hasVideo') && !value ? 'error' : 'info';
                addLog(`  ${key}: ${value}`, type);
            });
            
            // An√°lise
            if (withoutProviders.hasVideo && !withProviders.hasVideo) {
                addLog('üö® PROBLEMA IDENTIFICADO: V√≠deo funciona SEM providers mas n√£o COM providers!', 'error');
                
                const inactiveProviders = Object.entries(providerState)
                    .filter(([name, active]) => !active)
                    .map(([name]) => name);
                
                if (inactiveProviders.length > 0) {
                    addLog(`üéØ Providers desativados: ${inactiveProviders.join(', ')}`, 'warning');
                    addLog('üí° O problema pode estar em um dos providers ATIVOS restantes', 'warning');
                } else {
                    addLog('üí° Todos os providers est√£o ativos - problema pode ser na combina√ß√£o deles', 'warning');
                }
            } else if (withProviders.hasVideo && withoutProviders.hasVideo) {
                addLog('‚úÖ AMBOS FUNCIONAM: O problema n√£o est√° nos providers testados', 'success');
            } else if (!withProviders.hasVideo && !withoutProviders.hasVideo) {
                addLog('‚ùå NENHUM FUNCIONA: Problema pode ser de permiss√µes ou hardware', 'error');
            }
        }
        
        // Parar todos os testes
        function stopAllTests() {
            addLog('üõë Parando todos os testes...', 'info');
            
            if (streamWithProviders) {
                streamWithProviders.getTracks().forEach(track => track.stop());
                streamWithProviders = null;
                videoWithProviders.srcObject = null;
            }
            
            if (streamWithoutProviders) {
                streamWithoutProviders.getTracks().forEach(track => track.stop());
                streamWithoutProviders = null;
                videoWithoutProviders.srcObject = null;
            }
            
            document.getElementById('labelWithProviders').textContent = 'V√≠deo COM Providers';
            document.getElementById('labelWithoutProviders').textContent = 'V√≠deo SEM Providers (Controle)';
            
            addLog('‚úÖ Todos os testes parados', 'success');
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            addLog('üéØ Teste de providers carregado', 'info');
            addLog('üí° Desative providers um por um e teste para identificar o problema', 'info');
            addLog('üîß Use "Testar COM Providers" para simular a aplica√ß√£o complexa', 'info');
            addLog('üß™ Use "Testar SEM Providers" como controle simples', 'info');
            
            applyProviderEffects();
        });
    </script>
</body>
</html>


